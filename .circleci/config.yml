# Initial CI
# version: 2.1
# jobs:
#   build:
#     working_directory: ~/auditLog/frontend
#     docker:
#       - image: cimg/node:16.13.1
#     steps:    
#       - checkout:
#           path: ~/auditLog
#       - run:
#           name: Update Yarn
#           command: "sudo npm install -g --force yarn"
#       - restore_cache:
#           key: dependency-cache-{{ checksum "yarn.lock" }}
#       - run:
#           name: Install Dependencies
#           command: yarn install
#       - save_cache:
#           key: dependency-cache-{{ checksum "yarn.lock" }}
#           paths:
#             - ~/auditLog/.cache
#       - run:
#           name: Run tests
#           command: yarn test

# Updated CI
version: 2.1
orbs:
  eb: circleci/aws-elastic-beanstalk@2.0.1
  node: circleci/node@5.0

jobs:
  eb-create-and-deploy:
    working_directory: ~/project/frontend
    docker:
      - image: 'cimg/base:stable'
    steps:
      - eb/setup
      - run:
          command: |
            eb create auditLog-env
            eb deploy auditLog-env
            eb status
          

workflows:
  test-and-build:
    jobs:
      - node/test:
          app-dir: ~/project/frontend
          pkg-manager: yarn
      - eb-create-and-deploy:
          requires:
            - node/test